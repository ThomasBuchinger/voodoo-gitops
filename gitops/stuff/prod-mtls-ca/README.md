# mTLS Details

This repository only contains the private key. The Certificate for the Root-CA is generated by cert-manager (if `spec.secretName` exists and contains a Key, it is reused). You can re-generate the Key using this command:

```shell
# openssl req -x509 -newkey rsa:4096 -keyout secrets/stuff/prod-mtls-ca/tls.key -out secrets/stuff/prod-mtls-ca/tls.crt -sha512 -days 364 -nodes -subj "/C=AT/O=BUC LAB/CN=mtls-buc-root-ca" -addext basicConstraints=critical,CA:TRUE -addext "keyUsage=critical,cRLSign,keyCertSign,digitalSignature,keyAgreement,keyEncipherment"  -reqopt authorityKeyIdentifier=keyid


openssl req -x509 -newkey rsa:4096 -keyout secrets/stuff/prod-mtls-ca/tls.key -out secrets/stuff/prod-mtls-ca/tls.crt -sha256 -days 364 -nodes -subj "/C=AT/O=BUC LAB/CN=mtls-buc-root-ca" -addext basicConstraints=critical,CA:TRUE -addext "keyUsage=critical,cRLSign,keyCertSign,digitalSignature,keyAgreement,keyEncipherment"
kubectl create secret tls mtls-buc-root-ca --cert secrets/stuff/prod-mtls-ca/tls.crt --key secrets/stuff/prod-mtls-ca/tls.key --certificate-authority secrets/stuff/prod-mtls-ca/tls.crt --dry-run=client -o yaml --namespace prod > secrets/stuff/prod-mtls-ca/mtls-buc-root-ca.yaml
make kubeseal

```

Device Certificates are signed directly by the Root-CA

(Maybe) To allow temporary access from unknown devices, a intermediary CA could be used to issue Certificates with only 24h lifetime